# 2025年全国大学生工程实践与创新能力大赛（工创）--视觉识别部分

本代码是该比赛智慧物流搬运赛道的视觉识别部分，该方案采用深度学习的方式进行颜色识别，对于圆环和直线的识别仍然采用传统的图像处理方法。

## 项目结构

下面不会在讲到非必要文件，例如.gitignore，LICENSE等文件

```
USART                       用于存放有关串口通信代码的包文件夹
    |___ __init__.py        串口通信代码的初始化文件
    |___ communicate.py     串口通信代码
detector
    |___ __init__.py        检测器的初始化文件
    |___ Detector.py        检测器的基类
    |___ LineDetector.py    直线检测器
    |___ CircleDetector.py  圆环检测器
    |___ ColorDetector.py   颜色检测器
utils                       用于存放工具代码的文件夹
    |___ __init__.py        工具代码的初始化文件
    |___ dataset.py         存放摄像头相关的代码
AdjustConfig.py             用于调整配置的调试代码
Solution.py                 用于存放解决方案的代码，包括颜色识别，圆环识别，直线识别以及串口等使用的函数
test_Solution.py            用于测试Solution或者detector的功能
img_trans.py                用于远程图传的代码，主要用于调试过程方便在电脑上得到图像
main.py                     主程序，直接在Jetson或者树莓派上运行的代码
```

## 识别思路

使用传统的颜色识别，但是进行了色相滑块的重构，使用中心点色相和容差的方式识别色相，然后轻微对饱和度和亮度进行调整，基本可以保证参数的鲁棒性。
不再提供圆环的定位，而是使用圆环旁边的T型路口的直角进行定位，一方面，这个定位的值不会太飘，另一方面，这个定位不需要写其他的定位，全场的定位可以完全依赖这个。
函数设计上，将所有的顶层需求都使用固定参数传入，固定类型传出，从而实现顶层的多态，底层的单一职责，这样可以保证代码的可维护性和可扩展性。

## 当前电控可以直接调用的接口

即返回值封装成了字符，可以直接串口进行发送返回值

- 物料的运动检测，即物料所在位号发生变化认为物料运动

```
"1" 代表物料运动
```

- 获取物料位置，返回位号

```
"R1G2B3"代表红色在1号位，绿色在2号位，蓝色在3号位
如果有物料没识别到位号（可能被夹走），对应的数字变为F
```

- 直角检测

```
返回角度大于0的直线(参与直角的组成)角度和直角的交点坐标

str的结果会表示为
    'AHXXPHxxxHyyy'，
        其中：
        A和a代表第一个和第二个直线的角度
        P代表交点
        H代表正负号（0和1）
        XX代表角度
        xxx和yyy代表交点的坐标
```

## 完成的功能

即返回值没有进行封装，只是方便其他方法的使用，不能使用串口直接发送

- 物料追踪
    根据更改solution的`多边形边数参数nums`(在config.json)选择对应的跟踪，默认为0

## 外部调节的参数(config.json)

### 直线识别参数

该参数尽量固定

```json
{
    ...
    "LineDetector": {
        "Min_val": 120,         //Canny边缘检测的低阈值
        "Max_val": 255,         //Canny边缘检测的高阈值
        "Hough_threshold": 48,  //霍夫变换的阈值,值越大，检测时间越短，但是可能会丢失一些直线
        "minLineLength": 41,    //线段的最小长度
        "maxLineGap": 49,       //线段之间的最大间隔
        "bias": 3               //允许的角度误差
    }
}
```

### 位号参数

该参数尽量固定

```json
{
    ...
    "area1_points":[
        [0,0],      //左上角
        [0,0]       //右下角
    ],
    "area2_points":[
        [0,0],      //左上角
        [0,0]       //右下角
    ],
    "area3_points":[
        [0,0],      //左上角
        [0,0]       //右下角
    ]
}
```

### 颜色阈值

该参数尽量固定

```json
{
    "color": {
        "R": {
            "centre": 0,
            "error": 17,
            "L_S": 60,
            "U_S": 255,
            "L_V": 30,
            "U_V": 255
        },
        "G": {
            "centre": 65,
            "error": 21,
            "L_S": 25,
            "U_S": 255,
            "L_V": 31,
            "U_V": 255
        },
        "B": {
            "centre": 109,
            "error": 17,
            "L_S": 60,
            "U_S": 255,
            "L_V": 30,
            "U_V": 255
        }
    },
    "min_material_area": 2000,
    "max_material_area": 40000,
}
```
